<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NanoGPT</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-gray-100 flex items-center justify-center min-h-screen p-4">
  <div class="w-full max-w-2xl bg-gray-800 shadow-xl rounded-2xl p-8 border border-gray-700">
    
    <!-- Header -->
    <div class="text-center mb-6">
      <h1 class="text-3xl font-bold text-gray-100">
        NanoGPT
      </h1>
      <p class="text-gray-400 mt-2 text-sm">
        Enter a prompt and let your words be transformed into elegant Shakespearean prose.
      </p>
    </div>

    <!-- Prompt Input -->
    <textarea id="prompt" placeholder="Enter your prompt..."
      class="w-full p-4 rounded-xl bg-gray-700 text-gray-100 border border-gray-600 mb-4 focus:outline-none focus:ring-2 focus:ring-indigo-500 placeholder-gray-400"
      rows="4"></textarea>

    <!-- Generate Button -->
    <button id="generateBtn"
      class="w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-gray-100 rounded-xl font-semibold transition duration-200 shadow">
      Generate
    </button>

    <!-- Output -->
    <div class="mt-8">
      <h2 class="text-lg font-semibold mb-3 text-gray-200">Generated Text:</h2>
      <div id="output" class="p-5 bg-gray-700 border border-gray-600 rounded-xl min-h-[160px] whitespace-pre-wrap text-gray-100 text-sm leading-relaxed font-sans"></div>
    </div>
  </div>

  <script>
    const promptEl = document.getElementById("prompt");
    const generateBtn = document.getElementById("generateBtn");
    const outputEl = document.getElementById("output");

    async function generateText() {
      const prompt = promptEl.value.trim();
      if (!prompt) return;

      // Disable input and button while generating
      promptEl.disabled = true;
      generateBtn.disabled = true;
      generateBtn.classList.add("opacity-50", "cursor-not-allowed");

      outputEl.textContent = ""; // clear old text

      try {
        const response = await fetch("/generate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ prompt })
        });

        const reader = response.body.getReader();
        const decoder = new TextDecoder();

        let delay = 0; // ms per character

        async function readStream() {
          while (true) {
            const { done, value } = await reader.read();
            if (done) break;

            const chunk = decoder.decode(value, { stream: true });

            for (let char of chunk) {
              outputEl.textContent += char;
              await new Promise(r => setTimeout(r, delay));
            }
          }
        }

        await readStream();
      } catch (err) {
        outputEl.textContent = "⚠️ Error generating text. Please try again.";
        console.error(err);
      } finally {
        // Re-enable input and button
        promptEl.disabled = false;
        generateBtn.disabled = false;
        generateBtn.classList.remove("opacity-50", "cursor-not-allowed");
        promptEl.focus();
      }
    }

    // Click button
    generateBtn.addEventListener("click", generateText);

    // Enter key triggers generation (Shift+Enter inserts newline)
    promptEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault(); // prevent newline
        generateText();
      }
    });
  </script>
</body>
</html>
